{
  "hash": "6cd6e86e22aabc7a1ada83d42da6ad7c",
  "result": {
    "markdown": "---\ntitle: Association analysis\nformat:\n  html:\n    code-fold: false\nexecute:\n  cache: true\n  keep-ipynb: true\n---\n\n## Introduction\n\nWhile [Findr.jl][1] is developed primarily for causal inference from genomics and transcriptomics data, association analysis between genomics and transcriptomics data is also possible. In association analysis, genetic effects on the transcriptome are measured by testing if genes are differentially expressed in different groups of samples defined by the genotype of a genetic variant of interest. In [Findr.jl][1], significance of association is computed using a [categorical model](https://tmichoel.github.io/Findr.jl/dev/realLLR/#prim_test_realLLR) and a variant-specific background distribution. Similar to what was done in the [coexpression analysis tutorial](coexpression.qmd), this is achieved by modelling the distribution of association values between a given variant $A$ and all genes $B$ as a [mixture distribution](https://en.wikipedia.org/wiki/Mixture_distribution) of real and null (random) associations. The relative weight of each component then reflects the prior probability of finding a non-null $B$ gene for a given variant $A$, and is fitted for every $A$ separately.\n\nWe will illustrate how to run association analysis with [Findr.jl][1] using [preprocessed data][2] from the [GEUVADIS study][3]. See the [installation instructions](installation.qmd) for the steps you need to take to reproduce this tutorial.\n\n## Set up the environment\n\nWe begin by setting up the environment and loading some necessary packages.\n\n::: {.cell execution_count=2}\n``` {.julia .cell-code}\nusing DrWatson\nquickactivate(@__DIR__)\n\nusing DataFrames\nusing Arrow\n\nusing Findr\n```\n:::\n\n\n## Load data\n\n### Expression data\n\n[Findr.jl][1] expects that expression data are stored as [floating-point numbers](https://docs.julialang.org/en/v1/manual/integers-and-floating-point-numbers/) in a [DataFrame][4] where columns correspond to variables (genes) and rows to samples, see the [coexpression analysis tutorial](coexpression.qmd) for more details.\n\nThis tutorial uses two tables of expression data from the same set of samples, one for mRNA expression data called `dt`, and one for microRNA (miRNA) expression data called `dm`:\n\n::: {.cell execution_count=3}\n``` {.julia .cell-code}\ndt = DataFrame(Arrow.Table(datadir(\"exp_pro\",\"findr-data-geuvadis\", \"dt.arrow\")));\ndm = DataFrame(Arrow.Table(datadir(\"exp_pro\",\"findr-data-geuvadis\", \"dm.arrow\")));\n```\n:::\n\n\n### Genotype data\n\n[Findr.jl][1] expects that genotype data are stored as [integer numbers](https://docs.julialang.org/en/v1/manual/integers-and-floating-point-numbers/) in a [DataFrame][4] where columns correspond to variables (genetic variants) and rows to samples. Since [Findr.jl][1] uses a [categorical association model](https://tmichoel.github.io/Findr.jl/dev/realLLR/#prim_test_realLLR), it does not matter how different genotypes (e.g. heterozygous vs. homozygous) are encoded as integers. Future versions will support [scientific types](https://juliaai.github.io/ScientificTypes.jl/dev/) for representing genotype data.\n\nThis tutorial uses two tables of genotype data from the same set of samples as the expression data, one with genotypes for mRNA eQTLs called `dgt`, and one for microRNA (miRNA) eQTLs called `dgm`:\n\n::: {.cell execution_count=4}\n``` {.julia .cell-code}\ndgt = DataFrame(Arrow.Table(datadir(\"exp_pro\",\"findr-data-geuvadis\", \"dgt.arrow\")));\ndgm = DataFrame(Arrow.Table(datadir(\"exp_pro\",\"findr-data-geuvadis\", \"dgm.arrow\")));\n```\n:::\n\n\n## Run Findr.jl\n\nAssume we are interested in identifying mRNA genes whose expression levels are associated to microRNA eQTLs. We run:\n\n::: {.cell execution_count=5}\n``` {.julia .cell-code}\ndP = findr(dt, dgm, FDR=0.05)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div><div style = \"float: left;\"><span>43Ã—4 DataFrame</span></div><div style = \"float: right;\"><span style = \"font-style: italic;\">18 rows omitted</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Source</th><th style = \"text-align: left;\">Target</th><th style = \"text-align: left;\">Probability</th><th style = \"text-align: left;\">qvalue</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">rs5743580</td><td style = \"text-align: left;\">ENSG00000174130.7</td><td style = \"text-align: right;\">0.999339</td><td style = \"text-align: right;\">0.000661337</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">rs5743580</td><td style = \"text-align: left;\">ENSG00000174125.3</td><td style = \"text-align: right;\">0.998755</td><td style = \"text-align: right;\">0.00095324</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000169220.12</td><td style = \"text-align: right;\">0.99839</td><td style = \"text-align: right;\">0.00117203</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000196172.8</td><td style = \"text-align: right;\">0.990502</td><td style = \"text-align: right;\">0.00325359</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">rs5743580</td><td style = \"text-align: left;\">ENSG00000174123.6</td><td style = \"text-align: right;\">0.98831</td><td style = \"text-align: right;\">0.00494081</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">rs73236618</td><td style = \"text-align: left;\">ENSG00000174130.7</td><td style = \"text-align: right;\">0.987628</td><td style = \"text-align: right;\">0.00617937</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000262678.1</td><td style = \"text-align: right;\">0.986918</td><td style = \"text-align: right;\">0.00716539</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">rs73236618</td><td style = \"text-align: left;\">ENSG00000174125.3</td><td style = \"text-align: right;\">0.983834</td><td style = \"text-align: right;\">0.00829045</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">rs768533</td><td style = \"text-align: left;\">ENSG00000138400.8</td><td style = \"text-align: right;\">0.982444</td><td style = \"text-align: right;\">0.00931995</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">rs768533_1</td><td style = \"text-align: left;\">ENSG00000138400.8</td><td style = \"text-align: right;\">0.982444</td><td style = \"text-align: right;\">0.0101436</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">rs5743580</td><td style = \"text-align: left;\">ENSG00000197712.6</td><td style = \"text-align: right;\">0.981872</td><td style = \"text-align: right;\">0.0108695</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">rs3744749</td><td style = \"text-align: left;\">ENSG00000241990.1</td><td style = \"text-align: right;\">0.976618</td><td style = \"text-align: right;\">0.0119121</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">rs2961920</td><td style = \"text-align: left;\">ENSG00000204396.6</td><td style = \"text-align: right;\">0.973742</td><td style = \"text-align: right;\">0.0130157</td></tr><tr><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">32</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000220008.1</td><td style = \"text-align: right;\">0.925382</td><td style = \"text-align: right;\">0.0343305</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">33</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000253861.1</td><td style = \"text-align: right;\">0.919952</td><td style = \"text-align: right;\">0.0357159</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">34</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000253119.1</td><td style = \"text-align: right;\">0.919792</td><td style = \"text-align: right;\">0.0370245</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">35</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000123095.4</td><td style = \"text-align: right;\">0.919205</td><td style = \"text-align: right;\">0.0382751</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">36</td><td style = \"text-align: left;\">rs2961920</td><td style = \"text-align: left;\">ENSG00000236650.1</td><td style = \"text-align: right;\">0.917145</td><td style = \"text-align: right;\">0.0395134</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">37</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000183484.7</td><td style = \"text-align: right;\">0.916901</td><td style = \"text-align: right;\">0.0406914</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">38</td><td style = \"text-align: left;\">rs2961920</td><td style = \"text-align: left;\">ENSG00000100413.12</td><td style = \"text-align: right;\">0.912364</td><td style = \"text-align: right;\">0.0419268</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">39</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000259655.1</td><td style = \"text-align: right;\">0.904889</td><td style = \"text-align: right;\">0.0432905</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">40</td><td style = \"text-align: left;\">rs143756085</td><td style = \"text-align: left;\">ENSG00000231205.6</td><td style = \"text-align: right;\">0.903461</td><td style = \"text-align: right;\">0.0446217</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">41</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000242252.1</td><td style = \"text-align: right;\">0.895625</td><td style = \"text-align: right;\">0.0460791</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">42</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000129535.8</td><td style = \"text-align: right;\">0.891557</td><td style = \"text-align: right;\">0.0475639</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">43</td><td style = \"text-align: left;\">rs80283015</td><td style = \"text-align: left;\">ENSG00000101940.11</td><td style = \"text-align: right;\">0.890005</td><td style = \"text-align: right;\">0.0490158</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nFindr computes a [posterior probability](https://tmichoel.github.io/Findr.jl/dev/posteriorprobs/) of non-zero association for every **Source** variant (columns of `dgm`) and **Target** gene (columns of `dt`). By default the output is sorted by decreasing **Probability**. The optional parameter **FDR** can be used to limit the output to the set of pairs that has a [global false discovery rate (FDR)](https://en.wikipedia.org/wiki/False_discovery_rate#Storey-Tibshirani_procedure) less than a desired value (here set to 5%). The **qvalue** column in the output can be used for further filtering of the output, see the [coexpression analysis tutorial](coexpression.qmd) for further details.\n\nNote the order of the arguments. The first argument `dt` is the **Target** DataFrame, and the second argument the **Source** DataFrame.\n\n[1]: https://github.com/tmichoel/Findr.jl\n[2]: https://github.com/lingfeiwang/findr-data-geuvadis\n[3]: https://doi.org/10.1038/nature12531\n[4]: https://dataframes.juliadata.org/stable/\n[5]: https://doi.org/10.1371/journal.pcbi.1005703\n\n",
    "supporting": [
      "association_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}